<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Recriando o M√≥dulo Inventory - DW AdventureWorks</title>
    
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
    <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-sql.min.js"></script>
    
    <style>
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            font-size: 16px;
            line-height: 1.5;
            color: #24292e;  /* cor padr√£o do GitHub */
        }

        h1, h2, h3, h4 {
            font-family: 'Inter', sans-serif;
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        h1 {    
            box-sizing: border-box;
            display: inline;
            font-size: 2.2em;
            margin-bottom: 20px;
        }

        h2 {
            font-size: 1.8em;
            margin-top: 30px;
            margin-bottom: 15px;
        }

        h3 {
            font-size: 1.3em;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        p {
            margin-bottom: 15px;
        }

        ul, ol {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        pre [class*="language-"] {
            background-color: #f0f0f0 !important;
            padding: 15px;
            border-left: 4px solid #222222;
            overflow-x: auto;
            margin-bottom: 15px;
        }

        code [class*="language-"] {
            font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, Courier, monospace;
            background-color: #f0f0f0 !important;
            padding: 2px 4px;
            border-radius: 3px;
        }

        a {
            color: #1a0dab;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        img {
            max-width: 100%;
            display: block;
            margin: 20px 0;
        }

        hr {
            border: 0;
            border-top: 1px solid #ccc;
            margin: 30px 0;
        }

        .section {
            margin-bottom: 40px;
        }

        .emoji {
            margin-right: 5px;
        }
    </style>
</head>
<body>

<h1>Recriando o M√≥dulo Inventory do Data Warehouse AdventureWorks 2022</h1>

<div class="section">
    <h2><span class="emoji">üìå</span>1. Objetivo do projeto</h2>
    <p>Construir um Data Warehouse para o m√≥dulo Inventory do AdventureWorks 2022, replicando o fluxo OLTP ‚Üí DW para permitir an√°lises hist√≥ricas e m√©tricas de invent√°rio de modo simplificado.</p>
    <p>Este projeto foi desenvolvido com foco em:</p>
    <ul>
        <li>Criar e carregar tabelas de staging (stg_)</li>
        <li>Criar e carregar tabelas de Dimens√£o e Fato</li>
        <li>Aplicar transforma√ß√µes simples para padroniza√ß√£o</li>
        <li>Utilizar MERGE para cargas</li>
        <li>Implementa√ß√£o de chaves surrogate (SK)</li>
        <li>Padroniza√ß√£o de datas via DimDate</li>
    </ul>
</div>

<div class="section">
    <h2><span class="emoji">üìå</span>2. Ferramentas Utilizadas</h2>
    <ul>
        <li>SQL Server</li>
        <li>SQL Server Management Studio (SSMS)</li>
        <li>AdventureWorks 2022 OLTP (<a href="https://github.com/Microsoft/sql-server-samples/releases/download/adventureworks/AdventureWorks2022.bak" target="_blank">link para download</a>)</li>
    </ul>
</div>

<div class="section">
    <h2><span class="emoji">üìå</span>3. Arquitetura do Projeto</h2>
    <p>O DW foi constru√≠do seguindo um modelo dimensional no formato Star Schema, por√©m com caracter√≠sticas de Snowflake tamb√©m, por conta da hierarquia de produtos.</p>
    <p><strong>Tabelas de Dimens√£o:</strong></p>
    <ul>
        <li>DimProduct</li>
        <li>DimProductSubcategory</li>
        <li>DimProductCategory</li>
        <li>DimDate</li>
    </ul>
    <p><strong>Tabela de Fato:</strong></p>
    <ul>
        <li>FactProductInventory</li>
    </ul>
    <img src="./docs/Modelo_Dimensional.png" alt="Resultado final do Modelo Dimensional">
</div>

<div class="section">
    <h2><span class="emoji">üìå</span>4. Etapas</h2>

    <h3>4.1 Localiza√ß√£o e sele√ß√£o dos dados no OLTP para compor o DW</h3>
    <ul>
        <li>A estrutura do Data Warehouse original do AdventureWorks foi analisada usando como referencia: <a href="https://dataedo.com/samples/html/Data_warehouse/" target="_blank">https://dataedo.com/</a></li>
        <li>As tabelas do OLTP com dados relevantes para a constru√ß√£o do m√≥dulo Inventory foram mapeadas.</li>
        <li>Chaves prim√°rias e os relacionamentos do modelo transacional foram identificados.</li>
    </ul>

    <h3>4.2 Cria√ß√£o da tabela DimDate</h3>
    <p>A primeira estrutura criada foi a DimDate, respons√°vel por padronizar todas as datas usadas no DW.</p><br>
    <p>Exemplo resumido da estrutura:</p>
    <pre><code class="language-sql">
    CREATE TABLE dbo.DimDate (
    DateKey INT PRIMARY KEY,
    FullDate DATE NOT NULL,
    DayNumberOfWeek TINYINT,
    DayNumberOfMonth TINYINT,
    MonthNumberOfYear TINYINT,
    CalendarYear SMALLINT
);</code></pre>

    <h3>4.3 Cria√ß√£o das tabelas de Staging (STG)</h3>
    <p>Foram criadas tabelas intermedi√°rias (staging) para as Dimens√µes para receber os dados brutos vindos do OLTP.</p><br>
    <p>Essas tabelas serviram como camada tempor√°ria para armazenar, padronizar e validar os dados antes de carreg√°-los no DW.</p><br>
    <p>Exemplo resumido da estrutura da STG de DimProduct:</p>
    <pre><code class="language-sql">
    CREATE TABLE stg.DimProduct (
    ProductAlternateKey NVARCHAR(25) NOT NULL,
    ProductSubcategoryKey INT NULL,
    EnglishProductName NVARCHAR(50) NULL,
    Color NVARCHAR(15) NULL,
    StandardCost MONEY NULL,
    SellStartDate DATETIME NULL,
    SellEndDate DATETIME NULL,
    Status NVARCHAR(20) NULL
);</code></pre>

    <h3>4.4 Cria√ß√£o das tabelas finais do Data Warehouse</h3>
    <p>Ap√≥s a camada STG, foram criadas as tabelas dimensionais finais. Essas tabelas foram preparadas com suas surrogate keys, tipos de dados definitivos e a estrutura final do Schema.</p><br>
    <p>Exemplo resumido da estrutura da DimProduct:</p><br>
    <pre><code class="language-sql">
    CREATE TABLE dbo.DimProduct (
    ProductKey INT IDENTITY(1,1) PRIMARY KEY,
    ProductAlternateKey NVARCHAR(25) NOT NULL,
    ProductSubcategoryKey INT NULL,
    EnglishProductName NVARCHAR(50) NULL,
    Color NVARCHAR(15) NULL,
    StandardCost MONEY NULL,
    SellStartDate DATETIME NULL,
    SellEndDate DATETIME NULL,
    Status NVARCHAR(20) NULL
);</code></pre>

    <h3>4.5 Transforma√ß√£o e carga das tabelas STG</h3>
    <p>Os dados foram carregados na camada STG utilizando processos de transform/load, incluindo:</p><br>
    <ul>
        <li>Ajuste de tipos</li>
        <li>Sele√ß√£o das colunas relevantes</li>
        <li>Padroniza√ß√£o de dados</li>
        <li>Prepara√ß√£o para integridade referencial</li>
    </ul>
    
    <p>Exemplo resumido do Load da DimProduct:</p>
    <pre><code class="language-sql">
    DECLARE @LoadDate DATETIME = GETDATE();
    INSERT INTO dbo.stg_DimProduct (
        ProductAlternateKey,
        ProductSubcategoryKey,
        StandardCost,
        FinishedGoodsFlag,
        Color,
        ListPrice,
        SellStartDate,
        SellEndDate
    )
    SELECT
        p.ProductNumber,
        p.ProductSubcategoryID,
        p.StandardCost,
        p.FinishedGoodsFlag,
        p.Color,
        p.ListPrice,
        p.SellStartDate,
        p.SellEndDate,
        CASE 
            WHEN p.SellEndDate < @LoadDate THEN 'Discontinued'
            ELSE 'Current'
        END
    FROM Production.Product p
    LEFT JOIN Production.ProductModel pm 
           ON p.ProductModelID = pm.ProductModelID
    LEFT JOIN (
        SELECT pp.ProductID, pph.LargePhoto
        FROM Production.ProductProductPhoto pp
        JOIN Production.ProductPhoto pph 
             ON pp.ProductPhotoID = pph.ProductPhotoID
    ) ph ON p.ProductID = ph.ProductID;</code></pre>

    <h3>4.6 Carga das Dimens√µes usando MERGE</h3>
    <p>Com as tabelas STG prontas, para realmente simular um DW sendo atualizado com novos dados, as dimens√µes finais foram alimentadas usando comandos MERGE, que permite:</p><br>
    <ul>
        <li>Inserir registros novos</li>
        <li>Evitar duplicidades</li>
        <li>Sincronizar as dimens√µes com as tabelas de origem</li>
    </ul>
    
    <p>Exemplo resumido do MERGE da DimProduct:</p>
    
    <pre><code class="language-sql">
    MERGE DimProduct AS tgt
    USING stg.DimProduct AS src
        ON tgt.ProductAlternateKey = src.ProductAlternateKey
    WHEN MATCHED THEN
        UPDATE SET
            tgt.ProductSubcategoryKey = src.ProductSubcategoryKey,
            tgt.EnglishProductName    = src.EnglishProductName,
            tgt.Color                 = src.Color,
            tgt.StandardCost          = src.StandardCost,
            tgt.Status                = src.Status
    WHEN NOT MATCHED THEN
        INSERT (
            ProductAlternateKey,
            ProductSubcategoryKey,
            EnglishProductName,
            Color,
            StandardCost,
            StartDate,
            EndDate,
            Status
        )
        VALUES (
            src.ProductAlternateKey,
            src.ProductSubcategoryKey,
            src.EnglishProductName,
            src.Color,
            src.StandardCost,
            GETDATE(),
            '2014-12-31',
            'Current'
        );</code></pre>

    <h3>4.7 Cria√ß√£o e carga da tabela de fato (FactProductInventory)</h3>
    <p>Diferente das dimens√µes, a Fact foi criada sem passar pela camada STG, para simplificar o processo. Ela foi carregada diretamente com um INSERT + JOIN entre:</p><br>
    <ul>
        <li>DimProduct</li>
        <li>DimDate</li>
    </ul>
    
    <p>Exemplo resumido da Carga da Fact:</p>
    <pre><code class="language-sql">
    INSERT INTO dbo.FactProductInventory
    (
        ProductKey,
        DateKey,
        MovementDate
    )
    SELECT 
        dp.ProductKey,
        dd.DateKey,
        dd.FullDateAlternateKey AS MovementDate
    FROM dbo.DimProduct dp
    CROSS JOIN dbo.DimDate dd
    WHERE dd.FullDateAlternateKey BETWEEN '2010-01-01' AND '2014-12-31'
    ORDER BY dp.ProductKey, dd.DateKey;</code></pre>

    <h3>4.8 Cria√ß√£o dos relacionamentos</h3>
        <p>Por fim, foram criados os relacionamentos entre:</p><br>
    <ul>
        <li>FactProductInventory -> DimProduct</li>
        <li>FactProductInventory -> DimDate</li>
        <li>DimProduct -> DimProductSubcategory</li>
        <li>DimProductSubcategory -> DimProductCategory</li>
    </ul>
    
    <p>Exemplo do relacionamento - DimDate <- FactProductInventory -> DimProduct:</p>
    <pre><code class="language-sql">
            ALTER TABLE dbo.FactProductInventory
    ADD CONSTRAINT FK_FactProductInventory_Product
        FOREIGN KEY (ProductKey) REFERENCES dbo.DimProduct(ProductKey);
    
    ALTER TABLE dbo.FactProductInventory
    ADD CONSTRAINT FK_FactProductInventory_Date
        FOREIGN KEY (DateKey) REFERENCES dbo.DimDate(DateKey);</code></pre>
</div>

<div class="section">
    <h2><span class="emoji">üìå</span>5. Regras de Neg√≥cio</h2>
    <ul>
        <li>Cada movimento pertence a um produto (ProductKey)</li>
        <li>Cada movimento pertence a um dia espec√≠fico (DateKey)</li>
        <li>Integridade garantida via FK (ProductKey, DateKey)</li>
    </ul>
</div>

<div class="section">
    <h2><span class="emoji">üìå</span>6. Decis√µes de Modelagem</h2>
    <ul>
        <li>Colunas de tradu√ß√£o (Spanish, French, etc) como NULL nas dimens√µes para reduzir volume e focar nos atributos necess√°rios ao fluxo ETL.</li>
        <li>Colunas NULL na Fact: refletindo aus√™ncia de dados completos no OLTP e para simplificar a modelagem.</li>
    </ul>
</div>

<div class="section">
    <h2><span class="emoji">üìå</span>7. Valida√ß√µes Realizadas</h2>
    <ul>
        <li>Confer√™ncia de granularidade da Fact</li>
        <li>Verifica√ß√£o de schema via <code>sp_help</code></li>
        <li>Testes de integridade referencial (FKs)</li>
        <li>Confer√™ncia de duplicidades</li>
        <li>Confirma√ß√£o de SKs funcionando</li>
    </ul>
</div>

<div class="section">

    <h2><span class="emoji">üìå</span>8. Reposit√≥rio</h2>
    <p> O reposit√≥rio com o projeto completo est√° em:</p><br>
    <p><a href="https://github.com/Leonardo-Bonani/Recriando-o-Modulo-Inventory-do-Data-Warehouse-AdventureWork-2022/tree/main" target="_blank">Recriando o M√≥dulo Inventory do Data Warehouse AdventureWork 2022</a></p>
 
</div>

<div class="section">
    <h2><span class="emoji">üìå</span>9. Aprendizados</h2>
    <ul>
        <li>Modelagem dimensional com SQL Server</li>
        <li>Identificar e mapear dados no OLTP para modelar o DW (OLAP)</li>
        <li>Cria√ß√£o de dimens√µes e fato com chaves surrogate (IDENTITY)</li>
        <li>Constru√ß√£o e padroniza√ß√£o de DimDate</li>
        <li>Processo ETL completo: extra√ß√£o, transforma√ß√£o e carga</li>
        <li>Cria√ß√£o de tabelas STG e uso como camada intermedi√°ria</li>
        <li>Uso do comando MERGE para atualizar/inserir no DW</li>
        <li>Boas pr√°ticas de documenta√ß√£o para projetos de dados</li>
    </ul>
</div>

<div class="section">
    <h2><span class="emoji">üìå</span>10. Pr√≥ximos Passos</h2>
    <ul>
        <li>Expandir o DW para incluir novos m√≥dulos do AdventureWorks</li>
        <li>Criar dashboards anal√≠ticos (Power BI / Tableau) consumindo este DW</li>
    </ul>
</div>

<div class="section">
    <h2><span class="emoji">üìå</span>11. Refer√™ncias</h2>
    <ul>
        <li><a href="https://dataedo.com/samples/html/Data_warehouse/" target="_blank">https://dataedo.com/samples/html/Data_warehouse/</a></li>
    </ul>

</div>

<div class="section">
    <h2><span class="emoji">üìå</span>12. Autor</h2>
    <p>Leonardo Bonani<br>
    Contato: <a href="https://www.linkedin.com/in/leonardo-bonani" target="_blank">www.linkedin.com/in/leonardo-bonani</a></p>
</div>

</body>
</html>
