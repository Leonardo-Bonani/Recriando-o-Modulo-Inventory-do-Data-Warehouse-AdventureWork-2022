<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Recriando o Módulo Inventory - DW AdventureWorks</title>
    
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
    <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-sql.min.js"></script>
    
    <style>
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            font-size: 20px; /* Medium usa textos maiores */
            line-height: 1.7;
            color: #111;
            
            max-width: 840px;   /* largura típica do Medium */
            margin: 60px auto;  /* centraliza */
            padding: 0 24px;    /* espaço lateral no mobile */
            box-sizing: border-box;
        }

        h1, h2, h3 {
            font-family: 'Inter', sans-serif;
            font-weight: 700;
            letter-spacing: -0.02em;
            line-height: 1.25;
            padding-bottom: 20px;
            margin-top: 48px;
            margin-bottom: 16px;
            position: relative;

        }
        
        h1 {    
            box-sizing: border-box;
            font-size: 42px; 
            margin-bottom: 60px;
        }


        h2 {
            font-size: 32px;
            margin-top: 30px;
            margin-bottom: 30px;
        }


        h3 {
            font-size: 26px;
            margin-top: 20px;
            margin-bottom: 25px;
        }


        p {
            margin-bottom: 15px;
        }

        ul, ol {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        pre  {
            background-color: #f0f0f0;
            padding: 15px;
            border-left: 4px solid #222222;
            overflow-x: auto;
            margin-bottom: 15px;
        }

        code {
            font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, Courier, monospace;
            font-size: 18px; 
            padding: 2px 4px;
            border-radius: 3px;
        }

        a {
            color: #1a0dab;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        img {
            max-width: 100%;
            display: block;
            margin: 20px 0;
        }

        hr {
            border: 0;
            border-top: 1px solid #ccc;
            margin: 30px 0;
        }

               .section {
            margin-bottom: 60px;
            padding-bottom: 40px;
            position: relative;
        }
        
        .section::after {
            content: "";
            position: absolute;
            left: 50%;
            bottom: 0;
            transform: translateX(-50%);
            width: 160px; /* tamanho do separador */
            height: 2px;
            background: rgba(0,0,0,0.12);
            border-radius: 2px;
        }

    </style>
</head>
<body>

<h1>Recriando o Módulo Inventory do Data Warehouse AdventureWorks 2022</h1>

<div class="section">
    <h2>1. Objetivo do projeto</h2>
    <p>Construir um Data Warehouse para o módulo Inventory do AdventureWorks 2022, replicando o fluxo OLTP → DW para permitir análises históricas e métricas de inventário de modo simplificado.</p>
    <p>Este projeto foi desenvolvido com foco em:</p>
    <ul>
        <li>Criar e carregar tabelas de staging (stg_)</li>
        <li>Criar e carregar tabelas de Dimensão e Fato</li>
        <li>Aplicar transformações simples para padronização</li>
        <li>Utilizar MERGE para cargas</li>
        <li>Implementação de chaves surrogate (SK)</li>
        <li>Padronização de datas via DimDate</li>
    </ul>
</div>

<div class="section">
    <h2>2. Ferramentas Utilizadas</h2>
    <ul>
        <li>SQL Server</li>
        <li>SQL Server Management Studio (SSMS)</li>
        <li>AdventureWorks 2022 OLTP (<a href="https://github.com/Microsoft/sql-server-samples/releases/download/adventureworks/AdventureWorks2022.bak" target="_blank">link para download</a>)</li>
    </ul>
</div>

<div class="section">
    <h2>3. Arquitetura do Projeto</h2>
    <p>O DW foi construído seguindo um modelo dimensional no formato Star Schema, porém com características de Snowflake também, por conta da hierarquia de produtos.</p>
    <p><strong>Tabelas de Dimensão:</strong></p>
    <ul>
        <li>DimProduct</li>
        <li>DimProductSubcategory</li>
        <li>DimProductCategory</li>
        <li>DimDate</li>
    </ul>
    <p><strong>Tabela de Fato:</strong></p>
    <ul>
        <li>FactProductInventory</li>
    </ul>
    <img src="./docs/Modelo_Dimensional.png" alt="Resultado final do Modelo Dimensional">
</div>

<div class="section">
    <h2>4. Etapas</h2>

    <h3>4.1 Localização e seleção dos dados no OLTP para compor o DW</h3>
    <ul>
        <li>A estrutura do Data Warehouse original do AdventureWorks foi analisada usando como referencia: <a href="https://dataedo.com/samples/html/Data_warehouse/" target="_blank">https://dataedo.com/</a></li>
        <li>As tabelas do OLTP com dados relevantes para a construção do módulo Inventory foram mapeadas.</li>
        <li>Chaves primárias e os relacionamentos do modelo transacional foram identificados.</li>
    </ul>

    <h3>4.2 Criação da tabela DimDate</h3>
    <p>A primeira estrutura criada foi a DimDate, responsável por padronizar todas as datas usadas no DW.</p>
    <p>Exemplo resumido da estrutura:</p>
    <pre><code class="language-sql">
    CREATE TABLE dbo.DimDate (
    DateKey INT PRIMARY KEY,
    FullDate DATE NOT NULL,
    DayNumberOfWeek TINYINT,
    DayNumberOfMonth TINYINT,
    MonthNumberOfYear TINYINT,
    CalendarYear SMALLINT
);</code></pre>

    <h3>4.3 Criação das tabelas de Staging (STG)</h3>
    <p>Foram criadas tabelas intermediárias (staging) para as Dimensões para receber os dados brutos vindos do OLTP.</p>
    <p>Essas tabelas serviram como camada temporária para armazenar, padronizar e validar os dados antes de carregá-los no DW.</p>
    <p>Exemplo resumido da estrutura da STG de DimProduct:</p>
    <pre><code class="language-sql">
    CREATE TABLE stg.DimProduct (
    ProductAlternateKey NVARCHAR(25) NOT NULL,
    ProductSubcategoryKey INT NULL,
    EnglishProductName NVARCHAR(50) NULL,
    Color NVARCHAR(15) NULL,
    StandardCost MONEY NULL,
    SellStartDate DATETIME NULL,
    SellEndDate DATETIME NULL,
    Status NVARCHAR(20) NULL
);</code></pre>

    <h3>4.4 Criação das tabelas finais do Data Warehouse</h3>
    <p>Após a camada STG, foram criadas as tabelas dimensionais finais. Essas tabelas foram preparadas com suas surrogate keys, tipos de dados definitivos e a estrutura final do Schema.</p>
    <p>Exemplo resumido da estrutura da DimProduct:</p>
    <pre><code class="language-sql">
    CREATE TABLE dbo.DimProduct (
    ProductKey INT IDENTITY(1,1) PRIMARY KEY,
    ProductAlternateKey NVARCHAR(25) NOT NULL,
    ProductSubcategoryKey INT NULL,
    EnglishProductName NVARCHAR(50) NULL,
    Color NVARCHAR(15) NULL,
    StandardCost MONEY NULL,
    SellStartDate DATETIME NULL,
    SellEndDate DATETIME NULL,
    Status NVARCHAR(20) NULL
);</code></pre>

    <h3>4.5 Transformação e carga das tabelas STG</h3>
    <p>Os dados foram carregados na camada STG utilizando processos de transform/load, incluindo:</p>
    <ul>
        <li>Ajuste de tipos</li>
        <li>Seleção das colunas relevantes</li>
        <li>Padronização de dados</li>
        <li>Preparação para integridade referencial</li>
    </ul>
    
    <p>Exemplo resumido do Load da DimProduct:</p>
    <pre><code class="language-sql">
    DECLARE @LoadDate DATETIME = GETDATE();
    INSERT INTO dbo.stg_DimProduct (
        ProductAlternateKey,
        ProductSubcategoryKey,
        StandardCost,
        FinishedGoodsFlag,
        Color,
        ListPrice,
        SellStartDate,
        SellEndDate
    )
    SELECT
        p.ProductNumber,
        p.ProductSubcategoryID,
        p.StandardCost,
        p.FinishedGoodsFlag,
        p.Color,
        p.ListPrice,
        p.SellStartDate,
        p.SellEndDate,
        CASE 
            WHEN p.SellEndDate < @LoadDate THEN 'Discontinued'
            ELSE 'Current'
        END
    FROM Production.Product p
    LEFT JOIN Production.ProductModel pm 
           ON p.ProductModelID = pm.ProductModelID
    LEFT JOIN (
        SELECT pp.ProductID, pph.LargePhoto
        FROM Production.ProductProductPhoto pp
        JOIN Production.ProductPhoto pph 
             ON pp.ProductPhotoID = pph.ProductPhotoID
    ) ph ON p.ProductID = ph.ProductID;</code></pre>

    <h3>4.6 Carga das Dimensões usando MERGE</h3>
    <p>Com as tabelas STG prontas, para realmente simular um DW sendo atualizado com novos dados, as dimensões finais foram alimentadas usando comandos MERGE, que permite:</p>
    <ul>
        <li>Inserir registros novos</li>
        <li>Evitar duplicidades</li>
        <li>Sincronizar as dimensões com as tabelas de origem</li>
    </ul>
    
    <p>Exemplo resumido do MERGE da DimProduct:</p>
    
    <pre><code class="language-sql">
    MERGE DimProduct AS tgt
    USING stg.DimProduct AS src
        ON tgt.ProductAlternateKey = src.ProductAlternateKey
    WHEN MATCHED THEN
        UPDATE SET
            tgt.ProductSubcategoryKey = src.ProductSubcategoryKey,
            tgt.EnglishProductName    = src.EnglishProductName,
            tgt.Color                 = src.Color,
            tgt.StandardCost          = src.StandardCost,
            tgt.Status                = src.Status
    WHEN NOT MATCHED THEN
        INSERT (
            ProductAlternateKey,
            ProductSubcategoryKey,
            EnglishProductName,
            Color,
            StandardCost,
            StartDate,
            EndDate,
            Status
        )
        VALUES (
            src.ProductAlternateKey,
            src.ProductSubcategoryKey,
            src.EnglishProductName,
            src.Color,
            src.StandardCost,
            GETDATE(),
            '2014-12-31',
            'Current'
        );</code></pre>

    <h3>4.7 Criação e carga da tabela de fato (FactProductInventory)</h3>
    <p>Diferente das dimensões, a Fact foi criada sem passar pela camada STG, para simplificar o processo. Ela foi carregada diretamente com um INSERT + JOIN entre:</p>
    <ul>
        <li>DimProduct</li>
        <li>DimDate</li>
    </ul>
    
    <p>Exemplo resumido da Carga da Fact:</p>
    <pre><code class="language-sql">
    INSERT INTO dbo.FactProductInventory
    (
        ProductKey,
        DateKey,
        MovementDate
    )
    SELECT 
        dp.ProductKey,
        dd.DateKey,
        dd.FullDateAlternateKey AS MovementDate
    FROM dbo.DimProduct dp
    CROSS JOIN dbo.DimDate dd
    WHERE dd.FullDateAlternateKey BETWEEN '2010-01-01' AND '2014-12-31'
    ORDER BY dp.ProductKey, dd.DateKey;</code></pre>

    <h3>4.8 Criação dos relacionamentos</h3>
        <p>Por fim, foram criados os relacionamentos entre:</p>
    <ul>
        <li>FactProductInventory -> DimProduct</li>
        <li>FactProductInventory -> DimDate</li>
        <li>DimProduct -> DimProductSubcategory</li>
        <li>DimProductSubcategory -> DimProductCategory</li>
    </ul>
    
    <p>Exemplo do relacionamento - DimDate <- FactProductInventory -> DimProduct:</p>
    <pre><code class="language-sql">
            ALTER TABLE dbo.FactProductInventory
    ADD CONSTRAINT FK_FactProductInventory_Product
        FOREIGN KEY (ProductKey) REFERENCES dbo.DimProduct(ProductKey);
    
    ALTER TABLE dbo.FactProductInventory
    ADD CONSTRAINT FK_FactProductInventory_Date
        FOREIGN KEY (DateKey) REFERENCES dbo.DimDate(DateKey);</code></pre>
</div>

<div class="section">
    <h2>5. Regras de Negócio</h2>
    <ul>
        <li>Cada movimento pertence a um produto (ProductKey)</li>
        <li>Cada movimento pertence a um dia específico (DateKey)</li>
        <li>Integridade garantida via FK (ProductKey, DateKey)</li>
    </ul>
</div>

<div class="section">
    <h2>6. Decisões de Modelagem</h2>
    <ul>
        <li>Colunas de tradução (Spanish, French, etc) como NULL nas dimensões para reduzir volume e focar nos atributos necessários ao fluxo ETL.</li>
        <li>Colunas NULL na Fact: refletindo ausência de dados completos no OLTP e para simplificar a modelagem.</li>
    </ul>
</div>

<div class="section">
    <h2>7. Validações Realizadas</h2>
    <ul>
        <li>Conferência de granularidade da Fact</li>
        <li>Verificação de schema via <code>sp_help</code></li>
        <li>Testes de integridade referencial (FKs)</li>
        <li>Conferência de duplicidades</li>
        <li>Confirmação de SKs funcionando</li>
    </ul>
</div>

<div class="section">

    <h2>8. Repositório</h2>
    <p> O repositório com o projeto completo está em:</p><br>
    <p><a href="https://github.com/Leonardo-Bonani/Recriando-o-Modulo-Inventory-do-Data-Warehouse-AdventureWork-2022/tree/main" target="_blank">Recriando o Módulo Inventory do Data Warehouse AdventureWork 2022</a></p>
 
</div>

<div class="section">
    <h2>9. Aprendizados</h2>
    <ul>
        <li>Modelagem dimensional com SQL Server</li>
        <li>Identificar e mapear dados no OLTP para modelar o DW (OLAP)</li>
        <li>Criação de dimensões e fato com chaves surrogate (IDENTITY)</li>
        <li>Construção e padronização de DimDate</li>
        <li>Processo ETL completo: extração, transformação e carga</li>
        <li>Criação de tabelas STG e uso como camada intermediária</li>
        <li>Uso do comando MERGE para atualizar/inserir no DW</li>
        <li>Boas práticas de documentação para projetos de dados</li>
    </ul>
</div>

<div class="section">
    <h2>10. Próximos Passos</h2>
    <ul>
        <li>Expandir o DW para incluir novos módulos do AdventureWorks</li>
        <li>Criar dashboards analíticos (Power BI / Tableau) consumindo este DW</li>
    </ul>
</div>

<div class="section">
    <h2>11. Referências</h2>
    <ul>
        <li><a href="https://dataedo.com/samples/html/Data_warehouse/" target="_blank">https://dataedo.com/samples/html/Data_warehouse/</a></li>
    </ul>

</div>

<div class="section">
    <h2>12. Autor</h2>
    <p>Leonardo Bonani<br>
    Contato: <a href="https://www.linkedin.com/in/leonardo-bonani" target="_blank">www.linkedin.com/in/leonardo-bonani</a></p>
</div>

</body>
</html>
